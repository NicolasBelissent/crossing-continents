---
import Layout from "@/layouts/Layout.astro";
import Container from "@/components/Container.astro";
import VideoCard from "@/components/VideoCard.astro";
import BlogCard from "@/components/BlogCard.astro";
import { SITE } from "@/consts";
import { getCollection } from 'astro:content';

// Get blog posts
const blogPosts = await getCollection('blog');
const sortedBlogs = blogPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Sample video data - replace with your actual videos
const videos = [
  {
    title: "Sample Video 1",
    description: "This is a sample video description. Replace with your actual video content.",
    videoUrl: "/videos/sample1.mp4",
    thumbnail: "/thumbnails/sample1.jpg"
  },
  {
    title: "Sample Video 2",
    description: "Another sample video with interesting content to share.",
    videoUrl: "/videos/sample2.mp4",
    thumbnail: "/thumbnails/sample2.jpg"
  },
  {
    title: "Sample Video 3",
    description: "More amazing video content goes here.",
    videoUrl: "/videos/sample3.mp4",
    thumbnail: "/thumbnails/sample3.jpg"
  },
];
---

<Layout>
  <!-- Hero Section -->
  <section class="min-h-screen flex items-center justify-center">
    <div class="w-full text-center">
      <h1 class="font-vcr text-5xl md:text-7xl lg:text-8xl animate-fade-in uppercase tracking-wider">
        {SITE.NAME}
      </h1>
    </div>
  </section>

  <!-- Latest Blogs Section -->
  <section id="blogs" class="py-20 scroll-mt-20 relative" style="z-index: 10;">
    <Container>
      <div class="flex justify-between items-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold relative" style="z-index: 10;">Latest Blogs</h2>
        <a href="/blogs" class="flex items-center gap-2 text-lg hover:opacity-70 transition-opacity">
          See more blogs
          <span class="text-2xl">→</span>
        </a>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {sortedBlogs.map((blog) => (
          <BlogCard
            title={blog.data.title}
            description={blog.data.description}
            date={blog.data.date}
            slug={blog.slug}
          />
        ))}
      </div>
    </Container>
  </section>

  <!-- Videos Section -->
  <section id="videos" class="py-20 scroll-mt-20 relative" style="z-index: 10;">
    <Container>
      <div class="flex justify-between items-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold relative" style="z-index: 10;">Latest Videos</h2>
        <a href="#videos" class="flex items-center gap-2 text-lg hover:opacity-70 transition-opacity">
          See more videos
          <span class="text-2xl">→</span>
        </a>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {videos.map((video) => (
          <VideoCard
            title={video.title}
            description={video.description}
            videoUrl={video.videoUrl}
            thumbnail={video.thumbnail}
          />
        ))}
      </div>
    </Container>
  </section>

  <!-- Track Us Section - COMING SOON -->
  <!-- See TRACK_US_FEATURE.md for implementation details -->

  <!-- About Section -->
  <section id="about" class="py-20 scroll-mt-20 bg-black/5 relative" style="z-index: 10;">
    <Container>
      <div class="max-w-3xl mx-auto">
        <h2 class="text-3xl md:text-4xl font-bold mb-8">About</h2>
        <div class="max-w-none">
          <p class="text-lg leading-relaxed mb-6">
            Welcome to our joint blog! This is a collaborative space where we share
            video content, stories, and creative projects that matter to us.
          </p>
          <p class="text-lg leading-relaxed mb-6">
            Our mission is to create engaging content that inspires, educates, and
            entertains. Each video represents our passion for storytelling and our
            commitment to quality content creation.
          </p>
          <p class="text-lg leading-relaxed">
            Feel free to explore our videos and get in touch if you'd like to
            collaborate or just say hello!
          </p>
        </div>
      </div>
    </Container>
  </section>

  <!-- Subscribe Section -->
  <section id="subscribe" class="py-16 scroll-mt-20 relative" style="z-index: 10;">
    <Container>
      <div class="max-w-2xl mx-auto text-center">
        <div class="p-8 rounded-lg" style="background-color: rgba(0, 0, 0, 0.05);">
          <h3 class="text-2xl md:text-3xl font-bold mb-4">Never Miss a Post</h3>
          <p class="text-lg mb-6 opacity-80">
            Get notified when we publish new adventures and stories
          </p>
          <form id="subscribe-form" class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
            <input
              type="email"
              id="email-input"
              placeholder="Enter your email"
              required
              class="flex-1 px-4 py-3 rounded-lg border-2 border-black/10 focus:border-black/30 outline-none transition-all"
              style="background-color: rgba(255, 255, 255, 0.8);"
            />
            <button
              type="submit"
              class="px-6 py-3 rounded-lg font-semibold transition-all duration-300 hover:opacity-80"
              style="background-color: rgba(0, 0, 0, 0.9); color: white;"
            >
              Subscribe
            </button>
          </form>
          <p id="subscribe-message" class="mt-4 text-sm opacity-0 transition-opacity duration-300"></p>
        </div>
      </div>
    </Container>
  </section>

  <!-- Sponsors Section -->
  <section id="sponsors" class="py-20 scroll-mt-20 relative" style="z-index: 10;">
    <Container>
      <div class="text-center mb-12">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Our Sponsors</h2>
        <p class="text-lg opacity-80">Thank you to the brands that support our journey</p>
      </div>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 items-center justify-items-center max-w-4xl mx-auto">
        <!-- Sponsor logos - replace with actual sponsor images -->
        <a href="https://www.patagonia.com" target="_blank" rel="noopener" class="sponsor-logo w-32 h-32 flex items-center justify-center rounded-lg p-6 transition-transform hover:scale-105" style="background-color: rgba(0, 0, 0, 0.05);">
          <span class="text-xl font-bold opacity-60">Patagonia</span>
        </a>
        <a href="https://www.redbull.com" target="_blank" rel="noopener" class="sponsor-logo w-32 h-32 flex items-center justify-center rounded-lg p-6 transition-transform hover:scale-105" style="background-color: rgba(0, 0, 0, 0.05);">
          <span class="text-xl font-bold opacity-60">Red Bull</span>
        </a>
        <a href="https://www.gopro.com" target="_blank" rel="noopener" class="sponsor-logo w-32 h-32 flex items-center justify-center rounded-lg p-6 transition-transform hover:scale-105" style="background-color: rgba(0, 0, 0, 0.05);">
          <span class="text-xl font-bold opacity-60">GoPro</span>
        </a>
        <a href="https://www.thenorthface.com" target="_blank" rel="noopener" class="sponsor-logo w-32 h-32 flex items-center justify-center rounded-lg p-6 transition-transform hover:scale-105" style="background-color: rgba(0, 0, 0, 0.05);">
          <span class="text-xl font-bold opacity-60">The North Face</span>
        </a>
      </div>
    </Container>
  </section>

</Layout>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fade-in 0.8s ease-out forwards;
  }

  .animate-fade-in-delay {
    animation: fade-in 0.8s ease-out 0.2s forwards;
    opacity: 0;
  }

  html {
    scroll-behavior: smooth;
  }

  #subscribe-message.show {
    opacity: 1;
  }

  #subscribe-message.success {
    color: #10b981;
  }

  #subscribe-message.error {
    color: #ef4444;
  }
</style>

<script>
  // Handle subscribe form submission
  const subscribeForm = document.getElementById('subscribe-form');
  const emailInput = document.getElementById('email-input');
  const subscribeMessage = document.getElementById('subscribe-message');

  if (subscribeForm) {
    subscribeForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = emailInput.value;

      // Show loading state
      subscribeMessage.textContent = 'Subscribing...';
      subscribeMessage.className = 'mt-4 text-sm show';

      try {
        const response = await fetch('/api/subscribe', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email }),
        });

        const data = await response.json();

        if (response.ok) {
          subscribeMessage.textContent = '✓ Successfully subscribed! Check your email for confirmation.';
          subscribeMessage.className = 'mt-4 text-sm show success';
          emailInput.value = '';
        } else if (response.status === 409) {
          subscribeMessage.textContent = '✓ You\'re already subscribed!';
          subscribeMessage.className = 'mt-4 text-sm show success';
          emailInput.value = '';
        } else {
          subscribeMessage.textContent = '✗ ' + (data.error || 'Something went wrong. Please try again.');
          subscribeMessage.className = 'mt-4 text-sm show error';
        }
      } catch (error) {
        subscribeMessage.textContent = '✗ Something went wrong. Please try again.';
        subscribeMessage.className = 'mt-4 text-sm show error';
      }

      // Hide message after 5 seconds
      setTimeout(() => {
        subscribeMessage.className = 'mt-4 text-sm';
      }, 5000);
    });
  }

</script>
